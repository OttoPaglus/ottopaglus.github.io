<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>电子书上传</title>
</head>
<body>
<h1>电子书上传</h1>
<form action="/upload" method="post" enctype="multipart/form-data">
    <center>
    <label for="file-upload">选择文件（epub;pdf格式）：</label>
    <input type="file" id="file-upload" name="file" accept=".epub,.pdf" />
    <input type="submit" value="上传" />
    </center>
</form>
<form name="input" action="/data" method="post">
    <center>
        请输入书籍编码：<input  id='bookid'type="text" name="bookid"><br> 
        请输入书名：<input  id='bookname'type="text" name="bookname"><br> 
        请输入作者：<input  id='writer'type="text" name="writer"><br>
        请输入作者国籍（例：【德】）：<input  id='nation'type="text" name="nation"><br>
        请输入ISBN：<input  id='isbn'type="text" name="isbn"><br>
        请输入分类号（一）（参照CIP）：<input  id='cbcm'type="text" name="cbcm"><br>
        请输入分类号（二）（外文专用）：<input  id='duwei_ten'type="text" name="duwei_ten"><br>
        请输入购入时间：<input  id='buytime'type="text" name="buytime"><br>
        请输入购入地点：<input  id='buyplace'type="text" name="buyplace"><br>
        请输入购入原因：<input  id='reason'type="text" name="reason"><br>
        请输入入库时间：<input  id='catatime'type="text" name="catatime"><br>
        请输入藏书位置：<input  id='bookplace'type="text" name="bookplace"><br>
        <h3>完成请点这</h3>
        <input type="button" onclick="save()" value="新增记录"/> 
        <p>---------------</p>
        输入别名(key)：<input type="text" id="search_bookid" name="search_bookid"/>  
        <input type="button" onclick="find()" value="查找记录"/>  
        <p id="find_result"><br/></p>  
    </center>
</form>
</body>
</html>


<script>
    document.getElementById('file-upload').addEventListener('change', function(event) 
    {
        const file = event.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) 
        {
            const img = document.getElementById('file-preview');
            img.src = e.target.result;
            img.style.display = 'block';
        }
        
        if (file) 
        {
            reader.readAsDataURL(file);
        }
    });
    function save()
    {  
        var data = new Object;
        data.bookid=document.getElementById("bookid").value;
        data.bookname = document.getElementById("bookname").value;
        data.writer = document.getElementById("writer").value;  
        data.nation = document.getElementById("nation").value;
        data.isbn = document.getElementById("isbn").value;
        data.cbcm = document.getElementById("cbcm").value;
        data.duwei_ten= document.getElementById("duwei_ten").value;
        data.buytime = document.getElementById("buytime").value;
        data.buyplace = document.getElementById("buyplace").value;
        data.reason = document.getElementById("reason").value;
        data.catatime = document.getElementById("catatime").value;
        data.bookplace = document.getElementById("bookplace").value;
        var str = JSON.stringify(data); // 将对象转换为字符串
        localStorage.setItem(data.bookid,str);  
        alert("保存成功");
    }  
    function find()
    {  
        var search_bookid = document.getElementById("search_bookid").value;  
        var str1 = localStorage.getItem(search_bookid);  
        var find_result = document.getElementById("find_result");
        var bookinfo = JSON.parse(str1);  
        find_result.innerHTML = search_bookid + "的信息是：" + bookinfo.bookname + "，" + bookinfo.writer +"," + bookinfo.nation +"," + bookinfo.isbn +"," + bookinfo.cbcm +"," + bookinfo.duwei_ten +"," + bookinfo.buytime +"," + bookinfo.buyplace +"," + bookinfo.reason +"," + bookinfo.catatime +"," + bookinfo.bookplace;  
    }   
    function uploadFile() 
    {
        var fileInput = document.getElementById('file');
        var file = fileInput.files[0];

        if (file) {
            var formData = new FormData();
            formData.append('file', file);
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/upload', true);
            xhr.onload = function () 
            {
                if (xhr.status == 200) 
                {
                    alert('文件上传成功');
                } 
                else 
                {
                    alert('文件上传失败');
                }
            };
            xhr.send(formData);
        } 
        else 
        {
            alert('请选择一个文件');
        }
    }
</script>
